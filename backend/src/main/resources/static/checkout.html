<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Orders - Art Shop</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <style>
        .orders-container {
            max-width: 1200px;
            margin: 50px auto;
            padding: 20px;
        }
        .order-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 15px;
            margin-bottom: 15px;
        }
        .order-id {
            font-size: 18px;
            font-weight: bold;
            color: #667eea;
        }
        .order-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        .detail-item {
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
        }
        .detail-label {
            font-size: 12px;
            color: #6c757d;
        }
        .detail-value {
            font-size: 14px;
            font-weight: 600;
            color: #2c3e50;
        }
        .order-items {
            margin-top: 20px;
        }
        .order-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            border-bottom: 1px solid #e9ecef;
        }
        .order-total {
            text-align: right;
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
            margin-top: 15px;
        }
    </style>
    <script>
        const user = localStorage.getItem('user') || sessionStorage.getItem('user');
        if (!user) window.location.href = 'login.html';
    </script>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">üé® Art Shop</div>
            <ul class="nav-menu" id="nav-menu">
                <li><a href="gallery.html">Gallery</a></li>
                <li><a href="cart.html">Cart (<span id="cart-count">0</span>)</a></li>
                <li><a href="checkout.html" style="font-weight: bold;">My Orders</a></li>
                <li><span id="user-role-badge" style="padding: 5px 12px; border-radius: 20px; font-size: 0.85rem; margin-left: 10px;"></span></li>
                <li><span id="user-name" style="color: white; margin-left: 10px;"></span></li>
                <li><button onclick="logout()" class="btn btn-secondary" style="padding: 8px 20px;">Logout</button></li>
            </ul>
        </div>
    </nav>

    <div class="orders-container">
        <h1>üìã My Orders</h1>
        <p style="color: #7f8c8d; margin-bottom: 30px;">View your order details</p>
        <div id="orders-list"><p style="text-align: center; padding: 40px;">Loading orders...</p></div>
    </div>

    <script src="assets/js/main.js?v=8"></script>
    <script>
        async function loadOrders() {
            try {
                console.log('Loading orders...');
                const response = await fetch('/api/orders');
                const orders = await response.json();
                console.log('Orders loaded:', orders);
                const container = document.getElementById('orders-list');
                
                if (!orders || orders.length === 0) {
                    container.innerHTML = '<div style="text-align: center; padding: 60px;"><h2>No Orders Yet</h2><p>You haven\'t placed any orders yet.</p><a href="gallery.html" class="btn btn-primary">Start Shopping</a></div>';
                    return;
                }
                
                container.innerHTML = '';
                orders.forEach(order => {
                    const date = new Date(order.createdAt).toLocaleDateString();
                    const orderCard = document.createElement('div');
                    orderCard.className = 'order-card';
                    orderCard.innerHTML = `
                        <div class="order-header">
                            <div>
                                <div class="order-id">Order #${order.id.substring(0, 8)}</div>
                                <div style="color: #7f8c8d; font-size: 14px;">${date}</div>
                            </div>
                        </div>
                        <div class="order-details">
                            <div class="detail-item">
                                <div class="detail-label">Customer</div>
                                <div class="detail-value">${order.fullName}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Email</div>
                                <div class="detail-value">${order.email}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Address</div>
                                <div class="detail-value">${order.address}, ${order.city}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Postal Code</div>
                                <div class="detail-value">${order.postalCode}</div>
                            </div>
                        </div>
                        <div class="order-items">
                            <h3>Order Items:</h3>
                            ${order.items.map(item => `
                                <div class="order-item">
                                    <span><strong>${item.title}</strong> (Qty: ${item.quantity})</span>
                                    <span>$${(item.price * item.quantity).toFixed(2)}</span>
                                </div>
                            `).join('')}
                        </div>
                        <div class="order-total">Total Amount: $${order.totalAmount.toFixed(2)}</div>
                    `;
                    container.appendChild(orderCard);
                });
            } catch (error) {
                console.error('Error loading orders:', error);
                document.getElementById('orders-list').innerHTML = '<p style="text-align: center; color: red;">Error loading orders</p>';
            }
        }
        
        window.addEventListener('DOMContentLoaded', loadOrders);
        
        // Update navigation with user info
        (function() {
            const userStr = localStorage.getItem('user') || sessionStorage.getItem('user');
            if (userStr) {
                const user = JSON.parse(userStr);
                const userName = document.getElementById('user-name');
                const userRoleBadge = document.getElementById('user-role-badge');
                const navMenu = document.getElementById('nav-menu');
                
                if (userName) userName.textContent = `Welcome, ${user.firstName}!`;
                
                // Display user role badge
                if (userRoleBadge) {
                    if (user.role === 'ARTIST') {
                        userRoleBadge.textContent = 'Artist';
                        userRoleBadge.style.background = '#27ae60';
                        userRoleBadge.style.color = 'white';
                        
                        // Add Dashboard link for artists
                        if (navMenu) {
                            const dashboardLi = document.createElement('li');
                            dashboardLi.innerHTML = '<a href="artist-dashboard.html">Dashboard</a>';
                            navMenu.insertBefore(dashboardLi, navMenu.children[3]);
                        }
                    } else {
                        userRoleBadge.textContent = 'Customer';
                        userRoleBadge.style.background = '#3498db';
                        userRoleBadge.style.color = 'white';
                    }
                }
            }
        })();
    </script>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>About Art Shop</h3>
                <p>Art Shop is your premier destination for discovering and purchasing unique artworks from talented artists around the world. We connect art lovers with exceptional pieces that inspire and transform spaces.</p>
                <div class="social-links">
                    <a href="#" aria-label="Facebook">üìò</a>
                    <a href="#" aria-label="Twitter">üê¶</a>
                    <a href="#" aria-label="YouTube">üì∫</a>
                    <a href="#" aria-label="Instagram">üì∑</a>
                </div>
            </div>
            <div class="footer-section">
                <h3>Contact Us</h3>
                <p><strong>Art Shop Gallery</strong><br>
                Email: <a href="mailto:info@artshop.com">info@artshop.com</a><br>
                Phone: <a href="tel:+1-555-ART-SHOP">+1 (555) ART-SHOP</a><br>
                Support: <a href="mailto:support@artshop.com">support@artshop.com</a></p>
                <h3 style="margin-top: 20px;">Quick Links</h3>
                <p>
                    <a href="gallery.html">Gallery</a> | 
                    <a href="cart.html">Cart</a> | 
                    <a href="artist-dashboard.html">Artist Portal</a>
                </p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 Art Shop. All rights reserved. | Empowering Artists, Inspiring Collectors</p>
        </div>
    </footer>
</body>
</html>
