all<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Artist Dashboard - Art Shop</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <script>
        const user = localStorage.getItem('user') || sessionStorage.getItem('user');
        if (!user) {
            window.location.href = 'artist-login.html';
        } else {
            const userData = JSON.parse(user);
            if (userData.role !== 'ARTIST') {
                alert('Access denied. Artists only.');
                window.location.href = 'login.html';
            }
        }
    </script>
    <style>
        .dashboard-container {
            max-width: 1200px;
            margin: 50px auto;
            padding: 20px;
        }
        .upload-section {
            background: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .my-artworks {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .artwork-item {
            display: flex;
            gap: 20px;
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 15px;
            align-items: center;
        }
        .artwork-preview {
            width: 100px;
            height: 100px;
            background: #f5f5f5;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">üé® Art Shop - Artist Dashboard</div>
            <ul class="nav-menu">
                <li><a href="artist-dashboard.html" style="font-weight: bold;">Dashboard</a></li>
                <li><a href="gallery.html">View Gallery</a></li>
                <li><span id="user-role-badge" style="background: #27ae60; color: white; padding: 5px 12px; border-radius: 20px; font-size: 0.85rem; margin-left: 10px;">Artist</span></li>
                <li><span id="nav-artist-name" style="color: white; margin-left: 10px;"></span></li>
                <li><button onclick="logout()" class="btn btn-secondary" style="padding: 8px 20px;">Logout</button></li>
            </ul>
        </div>
    </nav>

    <div class="dashboard-container">
        <h1>Welcome, <span id="artist-name"></span>! üé®</h1>
        <p style="color: #7f8c8d; margin-bottom: 30px;">Upload and manage your artworks</p>

        <!-- Upload Form -->
        <div class="upload-section">
            <h2>Upload New Artwork</h2>
            <form id="upload-form" class="checkout-form">
                <div class="form-group">
                    <label for="title">Artwork Title</label>
                    <input type="text" id="title" name="title" required>
                </div>
                
                <div class="form-group">
                    <label for="description">Description</label>
                    <input type="text" id="description" name="description" required>
                </div>
                
                <div class="form-group">
                    <label for="price">Price ($)</label>
                    <input type="number" id="price" name="price" step="0.01" min="0" required>
                </div>
                
                <div class="form-group">
                    <label for="imageFile">Upload Artwork Image</label>
                    <input type="file" id="imageFile" name="imageFile" accept="image/*" required>
                    <small style="color: #7f8c8d;">Upload an image from your computer (JPG, PNG, GIF)</small>
                    <div id="image-preview" style="margin-top: 10px; display: none;">
                        <img id="preview-img" style="max-width: 200px; max-height: 200px; border-radius: 8px;" />
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="category">Category</label>
                    <select id="category" name="category" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem;">
                        <option value="">Select a category</option>
                        <option value="Abstract">Abstract</option>
                        <option value="Portrait">Portrait</option>
                        <option value="Landscape">Landscape</option>
                        <option value="Modern">Modern</option>
                        <option value="Surrealism">Surrealism</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="stock">Stock Quantity</label>
                    <input type="number" id="stock" name="stock" value="1" min="1" required>
                </div>
                
                <button type="submit" class="btn btn-primary" style="width: 100%;">Upload Artwork</button>
            </form>
        </div>

        <!-- My Artworks -->
        <div class="my-artworks">
            <h2>My Artworks</h2>
            <div id="artworks-list">
                <p style="text-align: center; color: #7f8c8d; padding: 40px;">Loading your artworks...</p>
            </div>
        </div>
    </div>

    <script src="assets/js/main.js?v=8"></script>
    <script>
        const artistUser = JSON.parse(localStorage.getItem('user') || sessionStorage.getItem('user'));
        document.getElementById('artist-name').textContent = artistUser.firstName;
        document.getElementById('nav-artist-name').textContent = `Welcome, ${artistUser.firstName}!`;

        // Image preview
        document.getElementById('imageFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('preview-img').src = e.target.result;
                    document.getElementById('image-preview').style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        });

        // Upload artwork
        document.getElementById('upload-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // First upload the image
            const imageFile = document.getElementById('imageFile').files[0];
            if (!imageFile) {
                alert('Please select an image file');
                return;
            }
            
            const formData = new FormData();
            formData.append('file', imageFile);
            
            try {
                // Upload image first
                const uploadResponse = await fetch('/api/upload/image', {
                    method: 'POST',
                    body: formData
                });
                
                const uploadData = await uploadResponse.json();
                
                if (!uploadData.success) {
                    alert('Failed to upload image: ' + uploadData.message);
                    return;
                }
                
                // Then create artwork with the image URL
                const artwork = {
                    title: document.getElementById('title').value,
                    description: document.getElementById('description').value,
                    price: parseFloat(document.getElementById('price').value),
                    imageUrl: uploadData.imageUrl,
                    category: document.getElementById('category').value || 'Uncategorized',
                    stock: parseInt(document.getElementById('stock').value),
                    artist: artistUser.firstName + ' ' + artistUser.lastName,
                    artistId: artistUser.id
                };
                
                const response = await fetch('/api/artist/artworks', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(artwork)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('Artwork uploaded successfully!');
                    // Reset form
                    document.getElementById('upload-form').reset();
                    document.getElementById('image-preview').style.display = 'none';
                    // Reload artworks without page refresh
                    loadMyArtworks();
                    // Scroll to artworks section
                    document.querySelector('.my-artworks').scrollIntoView({ behavior: 'smooth' });
                } else {
                    alert('Failed to upload artwork: ' + data.message);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('An error occurred while uploading.');
            }
        });

        // Load artist's artworks
        async function loadMyArtworks() {
            try {
                const response = await fetch(`/api/artist/artworks/${artistUser.id}`);
                const artworks = await response.json();
                
                const container = document.getElementById('artworks-list');
                
                if (artworks.length === 0) {
                    container.innerHTML = '<p style="text-align: center; color: #7f8c8d; padding: 40px;">You haven\'t uploaded any artworks yet.</p>';
                    return;
                }
                
                container.innerHTML = artworks.map(artwork => {
                    const imageHtml = artwork.imageUrl 
                        ? `<img src="${artwork.imageUrl}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px;" alt="${artwork.title}">`
                        : 'üé®';
                    
                    return `
                        <div class="artwork-item">
                            <div class="artwork-preview">${imageHtml}</div>
                            <div style="flex-grow: 1;">
                                <h3 style="margin: 0 0 5px 0;">${artwork.title}</h3>
                                <p style="margin: 0; color: #7f8c8d; font-size: 0.9rem;">${artwork.description}</p>
                                <p style="margin: 5px 0 0 0; color: #667eea; font-weight: bold;">$${artwork.price.toFixed(2)}</p>
                                <p style="margin: 5px 0 0 0; color: #95a5a6; font-size: 0.85rem;">Stock: ${artwork.stock}</p>
                            </div>
                            <button onclick="deleteArtwork('${artwork.id}')" class="btn btn-danger">Delete</button>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Error loading artworks:', error);
            }
        }

        // Delete artwork
        async function deleteArtwork(id) {
            if (!confirm('Are you sure you want to delete this artwork?')) return;
            
            try {
                const response = await fetch(`/api/artist/artworks/${id}`, {
                    method: 'DELETE'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('Artwork deleted successfully!');
                    loadMyArtworks();
                } else {
                    alert('Failed to delete artwork');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('An error occurred while deleting.');
            }
        }

        // Load artworks on page load
        window.addEventListener('DOMContentLoaded', loadMyArtworks);
    </script>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>About Art Shop</h3>
                <p>Art Shop is your premier destination for discovering and purchasing unique artworks from talented artists around the world. We connect art lovers with exceptional pieces that inspire and transform spaces.</p>
                <div class="social-links">
                    <a href="#" aria-label="Facebook">üìò</a>
                    <a href="#" aria-label="Twitter">üê¶</a>
                    <a href="#" aria-label="YouTube">üì∫</a>
                    <a href="#" aria-label="Instagram">üì∑</a>
                </div>
            </div>
            <div class="footer-section">
                <h3>Contact Us</h3>
                <p><strong>Art Shop Gallery</strong><br>
                Email: <a href="mailto:info@artshop.com">info@artshop.com</a><br>
                Phone: <a href="tel:+1-555-ART-SHOP">+1 (555) ART-SHOP</a><br>
                Support: <a href="mailto:support@artshop.com">support@artshop.com</a></p>
                <h3 style="margin-top: 20px;">Quick Links</h3>
                <p>
                    <a href="gallery.html">Gallery</a> | 
                    <a href="cart.html">Cart</a> | 
                    <a href="artist-dashboard.html">Artist Portal</a>
                </p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 Art Shop. All rights reserved. | Empowering Artists, Inspiring Collectors</p>
        </div>
    </footer>
</body>
</html>
